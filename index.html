<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NORAD Strategic Defense Network</title>

<style>
    body{
        margin:0;
        background:black;
        color:#00ffcc;
        font-family:"Courier New", monospace;
        overflow: hidden;
    }
    header{
        background:#050a12;
        padding:20px;
        text-align:center;
        font-size:26px;
        border-bottom:2px solid #00ffcc;
        position: relative;
        z-index: 10;
    }
    .timer{
        font-size:20px;
        color:#ff3333;
    }
    .section{
        display:none;
        padding:20px;
        height: 80vh;
        overflow-y: auto;
        padding-bottom: 100px;
    }
    .cluster{
        border:1px solid #00ffcc;
        padding:15px;
        margin-bottom:20px;
        background:#07131f;
    }
    /* Math Formula Box Style */
    .formula-box {
        background: #001a00;
        border-left: 4px solid #00ffcc;
        padding: 10px 15px;
        margin: 15px 0;
        font-family: "Times New Roman", Times, serif;
        font-size: 18px;
        color: #ccffcc;
        line-height: 1.6;
    }
    .formula-box i {
        font-style: italic;
    }
    
    button{
        background:#001f33;
        color:#00ffcc;
        border:1px solid #00ffcc;
        padding:8px 16px;
        margin-top:10px;
        cursor:pointer;
        font-family: inherit;
        font-weight: bold;
    }
    button:hover{ background:#00334d; }
    input{
        background:black;
        color:#00ffcc;
        border:1px solid #00ffcc;
        padding:6px;
        font-family: inherit;
        width: 300px; 
    }
    .launchInput{
        width:100px;
        text-align:center;
    }
    
    /* POPUP STYLES */
    #popup, #gameControlsPopup{
        position:fixed;
        top:0;
        left:0;
        width:100%;
        height:100%;
        background:rgba(0,0,0,0.95);
        display:none;
        flex-direction: column;
        justify-content:center;
        align-items:center;
        font-size:30px;
        text-align:center;
        z-index: 100;
        border: 2px solid #00ffcc;
    }
    .flash{
        animation:flash 0.6s infinite;
    }
    @keyframes flash{
        0%{background:black;color:red;}
        50%{background:red;color:black;}
        100%{background:black;color:red;}
    }
    #skipBtn{
        position:fixed;
        bottom:15px;
        right:15px;
        background:#330000;
        color:red;
        font-weight:bold;
        z-index: 200;
    }

    /* GAME CANVAS */
    #gameContainer {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 10, 0, 1);
        z-index: 50;
    }
    canvas {
        display: block;
    }
    #gameUI {
        position: absolute;
        top: 20px;
        left: 20px;
        color: lime;
        font-size: 18px;
        pointer-events: none;
    }
    .control-box {
        border: 2px solid #00ffcc;
        padding: 40px;
        background: #001100;
        max-width: 500px;
    }
    .key {
        border: 1px solid white;
        padding: 5px 10px;
        border-radius: 4px;
        display: inline-block;
        margin: 2px;
        color: white;
    }
</style>
</head>
<body>

<header>
    NORTH AMERICAN AEROSPACE DEFENSE COMMAND PORTAL
    <div class="timer">Time Remaining: <span id="time">55:00</span></div>
</header>

<div id="start" class="section" style="display:block;text-align:center;padding-top:120px;">
    <h1>UNKNOWN ICBM DETECTED</h1>
    <p>Awaiting Authorization</p>
    <button onclick="beginMission()">BEGIN MISSION</button>
</div>

<div id="set1" class="section">
    <h2>Phase 1: Ground-Based Interceptor Authorization</h2>

    <div class="cluster">
        <h3>Cluster 1 – Decipher the Threat</h3>
        <p><b>Problem:</b> You have received an encrypted message from the Space-Based Infrared System, letting you know if the incoming ICBM is a threat or just a test.</p>
        <p><b>Encrypted Message:</b> "WKH LFEP LV QRW D WHVW. LW LV D UHDO WKUHDW."</p>
        <p><b>Hint:</b> "Et tu, Brute?" </p>
        <p>Enter the full decrypted sentence:</p>
        <input id="a1" placeholder="XXX...">
        <button onclick="checkAnswer(1)">Submit</button>
        <p id="code1"></p>
    </div>

    <div class="cluster">
        <h3>Cluster 2 – Determine Launch Origin</h3>
        <p><b>Problem:</b> Email the Chinese Diplomatic Agency (chinesediplomat@gmail.com) to see if the ICBM launched from their country. </p>
        <p>They will respond with the source city.</p>
        <p>Enter the ICBM Source City:</p>
        <input id="a2" placeholder="City Name">
        <button onclick="checkAnswer(2)">Submit</button>
        <p id="code2"></p>
    </div>

    <div class="cluster">
        <h3>Cluster 3 – Maximum Distance Calculation</h3>
        <p><b>Problem:</b> Launched at 45° angle. g = 10 m/s². No air resistance.</p>
        <p>At t = 120s (2 mins), vertical velocity is 5,745 m/s.</p>
        <p>Find the maximum horizontal distance in miles (round to nearest 100 miles).</p>
        
        <div class="formula-box">
            <i>v<sub>y</sub></i> = <i>v<sub>0y</sub></i> · sin(<i>θ</i>) - <i>g</i> · <i>t</i><br>
            <i>y</i> = <i>v<sub>0y</sub></i> · <i>t</i> - ½<i>g</i><i>t</i>²<br>
            <i>x</i> = <i>v<sub>0x</sub></i> · <i>t<sub>total</sub></i><br>
            <span style="font-size:14px; font-family:'Courier New'">1 mile = 1609 meters</span>
        </div>

        <input id="a3" placeholder="Distance in Miles">
        <button onclick="checkAnswer(3)">Submit</button>
        <p id="code3"></p>
    </div>

    <div class="cluster">
        <h3>Cluster 4 – Target City Identification</h3>
        <p><b>Problem:</b> Given the documents provided and the target advisor's intelligence (they sit at the front of Kane 110), determine the most likely target city.</p>
        <p>Enter the city's 3-letter Airport Code:</p>
        <input id="a4" placeholder="XYZ">
        <button onclick="checkAnswer(4)">Submit</button>
        <p id="code4"></p>
    </div>

    <h3>Enter All 4 Authorization Codes</h3>
    <p style="font-size:12px; color:gray;">(Codes are generated above upon solving clusters)</p>
    <input class="launchInput" id="l1">
    <input class="launchInput" id="l2">
    <input class="launchInput" id="l3">
    <input class="launchInput" id="l4">
    <br>
    <button onclick="launchPhase1()">LAUNCH INTERCEPTOR</button>
</div>

<div id="set2" class="section">
    <h2>Phase 2: Emergency Defense Protocol</h2>

    <div class="cluster">
        <h3>Cluster 5 – Altitude Logic Puzzle</h3>
        <p><b>Problem:</b>You have gotten 4 bits of information from your engineers tracking the ICBM. You have also found out that two of the engineers are actually spies and are lying (both their statements are false)! This means only 2 of the engineers have factual statements. Given the constraints, determine the missile's altitude in miles. You also know from a secret source that all digits are different.</p>
        <ul>
            <li><b>Alpha:</b> Digits in descending order. Ones is half of tens.</li>
            <li><b>Bravo:</b> Tens digit is 7. All digits sum to 14.</li>
            <li><b>Charlie:</b> All digits even. Ones digit is 8.</li>
            <li><b>Delta:</b> Hundreds odd, ones even. All digits < 6.</li>
        </ul>
        <p>Determine the missile altitude:</p>
        <input id="a5" placeholder="###">
        <button onclick="checkAnswer(5)">Submit</button>
        <p id="code5"></p>
    </div>

    <div class="cluster">
        <h3>Cluster 6 – Evacuation Protocol</h3>
        <p><b>Problem:</b> Create a plan to evacuate all personnel from the city and brief it to the GLP administrator. Upon completion, the administrator will provide a password to proceed.</p>
        <p>Enter the Administrator's Password:</p>
        <input id="a6" placeholder="Password">
        <button onclick="checkAnswer(6)">Submit</button>
        <p id="code6"></p>
    </div>

    <div class="cluster">
        <h3>Cluster 7 – Vector Collision</h3>
        <p><b>Problem: </b>The Missile Defense Agency has tracked the ICBM and determined its position and velocity vectors. Our GBI has a known starting position and velocity vector.</p>
        <p>ICBM: r = &lt;3000, 2000&gt; m, v = &lt;-150, -100&gt; m/s</p>
        <p>Interceptor: Starts at &lt;0,0&gt;, v = &lt;90, 60&gt; m/s</p>
        <p>Once launched how many seconds until collision?</p>
        
        <div class="formula-box">
            <i>r<sub>rel</sub></i> = <i>r<sub>R</sub></i> - <i>r<sub>I</sub></i><br>
            <i>v<sub>rel</sub></i> = <i>v<sub>R</sub></i> - <i>v<sub>I</sub></i><br>
            <i>r<sub>rel</sub></i> + <i>v<sub>rel</sub></i> · <i>t</i> = 0
        </div>

        <input id="a7" placeholder="Seconds">
        <button onclick="checkAnswer(7)">Submit</button>
        <p id="code7"></p>
    </div>

    <h3>Enter All 3 Authorization Codes</h3>
    <input class="launchInput" id="l5">
    <input class="launchInput" id="l6">
    <input class="launchInput" id="l7">
    <br>
    <button onclick="launchPhase2()">FINAL LAUNCH</button>
</div>

<div id="gameContainer">
    <canvas id="gameCanvas"></canvas>
    <div id="gameUI">RADAR TRACKING ACTIVE</div>
</div>

<div id="gameControlsPopup">
    <div class="control-box">
        <h2>INTERCEPTOR CONTROLS</h2>
        <p>USE KEYBOARD TO GUIDE INTERCEPTOR</p>
        <p>
            <span class="key">W</span> <span class="key">A</span> <span class="key">S</span> <span class="key">D</span>
            <br>OR<br>
            <span class="key">↑</span> <span class="key">←</span> <span class="key">↓</span> <span class="key">→</span>
        </p>
        <p style="color:red; margin-top:20px;">INTERCEPT THE HOSTILE TARGET</p>
        <button onclick="startGameEngine()">ENGAGE</button>
    </div>
</div>

<div id="popup"></div>
<button id="skipBtn" onclick="skipTime()">⚠ DO NOT PRESS</button>

<script>
/* --- CORE LOGIC --- */
let time=55*60;
let timer=null;

// UPDATED ANSWERS based on PDF
let answers = {
    1: "THE ICBM IS NOT A TEST. IT IS A REAL THREAT.", // Cluster 1
    2: "PYONGYANG",                                   // Cluster 2
    3: "6000",                                        // Cluster 3
    4: "SEA",                                         // Cluster 4 (Airport code)
    5: "542",                                         // Cluster 5
    6: "EVACUATE",                                    // Cluster 6
    7: "12.5"                                         // Cluster 7
};

// STATIC CODES (Fixed 4-character alphanumeric)
let staticCodes = {
    1: "8XJ2",
    2: "3B9Q",
    3: "K4M1",
    4: "7D5V",
    5: "P2L9",
    6: "4X8Z",
    7: "W1N6"
};

let codesRevealed = {}; // Tracks which have been unlocked
let currentPhase = 1;

function beginMission(){
    document.getElementById("start").style.display="none";
    document.getElementById("set1").style.display="block";
    timer=setInterval(updateTimer,1000);
}

function updateTimer(){
    let m=Math.floor(time/60);
    let s=time%60;
    document.getElementById("time").innerText=
    m.toString().padStart(2,'0')+":"+s.toString().padStart(2,'0');
    if(time<=0){
        document.body.innerHTML="<h1 style='color:red;text-align:center;padding-top:200px;'>MISSION FAILURE<br>ITS TOO LATE TO STOP THE ATTACK, USA IS COMPROMISED</h1>";
        clearInterval(timer);
    }
    time--;
}

function checkAnswer(n){
    // Normalize input: uppercase, trim whitespace, remove trailing periods if any
    let val = document.getElementById("a"+n).value.trim().toUpperCase();
    
    // Remove period at end if user typed a full sentence for Cluster 1
    if(n === 1 && val.endsWith('.')) {
        val = val.slice(0, -1);
    }
    
    let isCorrect = false;

    // --- MASTER CODE CHECK (DAWG) ---
    if(val === "DAWG") {
        isCorrect = true;
    } 
    // --- Standard Logic ---
    else if(n === 1) {
        // Special handling for long sentence to allow with/without punctuation
        let cleanInput = val.replace(/[^A-Z]/g, ""); // remove spaces/punct
        let cleanAnswer = answers[1].replace(/[^A-Z]/g, "");
        if(cleanInput === cleanAnswer) isCorrect = true;
    } else {
        if(val === answers[n]) isCorrect = true;
    }

    if(isCorrect){
        if(!codesRevealed[n]){
            codesRevealed[n] = staticCodes[n]; // Use the STATIC code
            document.getElementById("code"+n).innerText = "Authorization Code: " + staticCodes[n];
            document.getElementById("code"+n).style.color = "#00ffcc";
        }
    } else {
        alert("INCORRECT ANSWER");
    }
}

/* --- LAUNCH LOGIC --- */

function launchPhase1(){
    // Retrieve values
    let v1 = document.getElementById("l1").value.trim().toUpperCase();
    let v2 = document.getElementById("l2").value.trim().toUpperCase();
    let v3 = document.getElementById("l3").value.trim().toUpperCase();
    let v4 = document.getElementById("l4").value.trim().toUpperCase();

    // Check against STATIC codes OR the Master Code "DAWG"
    if(
        (v1 === staticCodes[1] || v1 === "DAWG") &&
        (v2 === staticCodes[2] || v2 === "DAWG") &&
        (v3 === staticCodes[3] || v3 === "DAWG") &&
        (v4 === staticCodes[4] || v4 === "DAWG")
    ){
        currentPhase = 1;
        initGameSequence();
    }else{
        alert("INVALID AUTHORIZATION SEQUENCE\n(Ensure you entered the codes or the testing master code)");
    }
}

function launchPhase2(){
    // Retrieve values
    let v5 = document.getElementById("l5").value.trim().toUpperCase();
    let v6 = document.getElementById("l6").value.trim().toUpperCase();
    let v7 = document.getElementById("l7").value.trim().toUpperCase();

    // Check against STATIC codes OR the Master Code "DAWG"
    if(
        (v5 === staticCodes[5] || v5 === "DAWG") &&
        (v6 === staticCodes[6] || v6 === "DAWG") &&
        (v7 === staticCodes[7] || v7 === "DAWG")
    ){
        currentPhase = 2;
        initGameSequence();
    }else{
        alert("INVALID AUTHORIZATION SEQUENCE");
    }
}

function initGameSequence(){
    // 1. Flash Launch
    let popup=document.getElementById("popup");
    popup.style.display="flex";
    popup.className="flash";
    popup.innerHTML="LAUNCH INITIATED...<br>ACQUIRING TARGET";
    
    setTimeout(()=>{
        popup.style.display="none";
        popup.className="";
        // 2. Show Controls
        document.getElementById("gameControlsPopup").style.display = "flex";
    }, 2000);
}

/* --- GAME ENGINE --- */
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
let gameLoopId;
let icbm = { x: 0, y: 0, vx: 0, vy: 0 };
let player = { x: 0, y: 0, speed: 5, w: 20, h: 20 };
let explosions = [];
let keys = {};
let gameActive = false;

// Input Handling
window.addEventListener('keydown', (e) => { keys[e.key] = true; });
window.addEventListener('keyup', (e) => { keys[e.key] = false; });

function resizeCanvas(){
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}

function startGameEngine(){
    document.getElementById("gameControlsPopup").style.display = "none";
    document.getElementById("gameContainer").style.display = "block";
    resizeCanvas();
    
    // Reset Player (Center Bottom)
    player.x = canvas.width / 2;
    player.y = canvas.height - 100;
    
    // Reset ICBM (Parabola from mid-left)
    icbm.x = 0;
    icbm.y = canvas.height / 2; 
    
    // SLOWER SPEED
    let speed = canvas.width / 1200; 
    icbm.vx = speed; 
    icbm.vy = -speed * 0.9; // Initial upward arc
    
    explosions = [];
    gameActive = true;
    loop();
}

function loop(){
    if(!gameActive) return;

    // Clear
    ctx.fillStyle = "rgba(0, 10, 0, 0.4)"; 
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Draw Grid
    ctx.strokeStyle = "#003300";
    ctx.lineWidth = 1;
    ctx.beginPath();
    for(let i=0; i<canvas.width; i+=100){ ctx.moveTo(i,0); ctx.lineTo(i,canvas.height); }
    for(let i=0; i<canvas.height; i+=100){ ctx.moveTo(0,i); ctx.lineTo(canvas.width,i); }
    ctx.stroke();

    // 1. Update Player (WASD / Arrows)
    if(keys['w'] || keys['ArrowUp']) player.y -= player.speed;
    if(keys['s'] || keys['ArrowDown']) player.y += player.speed;
    if(keys['a'] || keys['ArrowLeft']) player.x -= player.speed;
    if(keys['d'] || keys['ArrowRight']) player.x += player.speed;

    // Clamp Player
    if(player.x < 0) player.x = 0;
    if(player.x > canvas.width) player.x = canvas.width;
    if(player.y < 0) player.y = 0;
    if(player.y > canvas.height) player.y = canvas.height;

    // Draw Player
    ctx.fillStyle = "#00ffcc";
    ctx.beginPath();
    ctx.moveTo(player.x, player.y - 10);
    ctx.lineTo(player.x - 10, player.y + 10);
    ctx.lineTo(player.x + 10, player.y + 10);
    ctx.fill();

    // 2. Update ICBM
    icbm.x += icbm.vx;
    icbm.y += icbm.vy;
    icbm.vy += 0.002; // Very low gravity for slow arc
    
    // Draw ICBM
    ctx.fillStyle = "red";
    ctx.beginPath();
    ctx.moveTo(icbm.x + 15, icbm.y);
    ctx.lineTo(icbm.x - 5, icbm.y - 5);
    ctx.lineTo(icbm.x - 5, icbm.y + 5);
    ctx.fill();
    ctx.font = "14px Courier";
    ctx.fillStyle = "white";
    ctx.fillText("HOSTILE", icbm.x - 20, icbm.y - 15);

    // 3. Collision Detection
    let dist = Math.hypot(icbm.x - player.x, icbm.y - player.y);
    
    if(dist < 30){
        handleGameEnd(true); // Hit
        return;
    }

    if(icbm.x > canvas.width || icbm.y > canvas.height){
        handleGameEnd(false); // Miss
        return;
    }

    requestAnimationFrame(loop);
}

function handleGameEnd(isHit){
    gameActive = false;
    
    if(isHit){
        ctx.fillStyle = "orange";
        ctx.beginPath();
        ctx.arc(icbm.x, icbm.y, 50, 0, Math.PI*2);
        ctx.fill();
    }

    setTimeout(()=>{
        document.getElementById("gameContainer").style.display = "none";
        
        if(currentPhase === 1){
            // PHASE 1: ALWAYS MALFUNCTION
            let popup = document.getElementById("popup");
            popup.style.display = "flex";
            popup.className = "flash"; 
            
            let msg = isHit ? "LAST MINUTE MALFUNCTION" : "INTERCEPTION FAILED.";
            msg += "<br><br>GBI MISSED TARGET.<br>TIME IS TICKING...";
            
            popup.innerHTML = "<div style='border:2px solid red; padding:20px; background:black;'>" + msg + "</div>";
            
            setTimeout(()=>{
                popup.style.display="none";
                popup.className="";
                document.getElementById("set1").style.display="none";
                document.getElementById("set2").style.display="block";
            }, 4000);

        } else if (currentPhase === 2){
            // PHASE 2: REAL OUTCOME
            if(isHit){
                document.body.innerHTML="<h1 style='color:lime;text-align:center;padding-top:200px;font-size:50px;'>MISSION SUCCESS<br>THREAT NEUTRALIZED</h1>";
                clearInterval(timer);
            } else {
                alert("MISSED TARGET - RE-ENGAGING TRACKING SYSTEMS");
                startGameEngine();
            }
        }
    }, 500);
}

function skipTime(){
    time-=600;
    if(time<0) time=0;
}
</script>

</body>
</html>
