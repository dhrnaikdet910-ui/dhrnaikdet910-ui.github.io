<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NORAD Strategic Defense Network</title>

<style>
    body{
        margin:0;
        background:black;
        color:#00ffcc;
        font-family:"Courier New", monospace;
        overflow: hidden;
    }
    header{
        background:#050a12;
        padding:20px;
        text-align:center;
        font-size:26px;
        border-bottom:2px solid #00ffcc;
        position: relative;
        z-index: 10;
    }
    .timer{
        font-size:20px;
        color:#ff3333;
    }
    .section{
        display:none;
        padding:20px;
        height: 80vh;
        overflow-y: auto;
        padding-bottom: 100px;
    }
    .cluster{
        border:1px solid #00ffcc;
        padding:15px;
        margin-bottom:20px;
        background:#07131f;
    }
    button{
        background:#001f33;
        color:#00ffcc;
        border:1px solid #00ffcc;
        padding:8px 16px;
        margin-top:10px;
        cursor:pointer;
        font-family: inherit;
        font-weight: bold;
    }
    button:hover{ background:#00334d; }
    input{
        background:black;
        color:#00ffcc;
        border:1px solid #00ffcc;
        padding:6px;
        font-family: inherit;
    }
    .launchInput{
        width:80px;
        text-align:center;
    }
    
    /* POPUP STYLES */
    #popup, #gameControlsPopup{
        position:fixed;
        top:0;
        left:0;
        width:100%;
        height:100%;
        background:rgba(0,0,0,0.95);
        display:none;
        flex-direction: column;
        justify-content:center;
        align-items:center;
        font-size:30px;
        text-align:center;
        z-index: 100;
        border: 2px solid #00ffcc;
    }
    .flash{
        animation:flash 0.6s infinite;
    }
    @keyframes flash{
        0%{background:black;color:red;}
        50%{background:red;color:black;}
        100%{background:black;color:red;}
    }
    #skipBtn{
        position:fixed;
        bottom:15px;
        right:15px;
        background:#330000;
        color:red;
        font-weight:bold;
        z-index: 200;
    }

    /* GAME CANVAS */
    #gameContainer {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 10, 0, 1);
        z-index: 50;
    }
    canvas {
        display: block;
    }
    #gameUI {
        position: absolute;
        top: 20px;
        left: 20px;
        color: lime;
        font-size: 18px;
        pointer-events: none;
    }
    .control-box {
        border: 2px solid #00ffcc;
        padding: 40px;
        background: #001100;
        max-width: 500px;
    }
    .key {
        border: 1px solid white;
        padding: 5px 10px;
        border-radius: 4px;
        display: inline-block;
        margin: 2px;
        color: white;
    }
</style>
</head>
<body>

<header>
    NORAD STRATEGIC DEFENSE COMMAND
    <div class="timer">Time Remaining: <span id="time">55:00</span></div>
</header>

<div id="start" class="section" style="display:block;text-align:center;padding-top:120px;">
    <h1>UNKNOWN ICBM DETECTED</h1>
    <p>Awaiting Authorization</p>
    <button onclick="beginMission()">BEGIN MISSION</button>
</div>

<div id="set1" class="section">
    <h2>Phase 1: Ground-Based Interceptor Authorization</h2>
    <div class="cluster">
        <h3>Cluster 1 – Encrypted Launch Telemetry</h3>
        <p>Intercepted Text: "KHOOR QRUDG RSHUDWRUV. WKH ODXQFK FRGH LV FUBSWR."</p>
        <p><b>Hint:</b> Shift -3 (Caesar Cipher).</p>
        <input id="a1"><button onclick="checkAnswer(1)">Submit</button>
        <p id="code1"></p>
    </div>
    <div class="cluster">
        <h3>Cluster 2 – Parabolic Trajectory Range</h3>
        <p>y(x) = -0.0002x² + 0.7x + 1.8. Find positive root for y=0. Round to 10.</p>
        <input id="a2"><button onclick="checkAnswer(2)">Submit</button>
        <p id="code2"></p>
    </div>
    <div class="cluster">
        <h3>Cluster 3 – Target City Identification</h3>
        <p>Coastal, Tech Sector, ~3500km from N. Pacific. Enter Airport Code.</p>
        <input id="a3"><button onclick="checkAnswer(3)">Submit</button>
        <p id="code3"></p>
    </div>
    <div class="cluster">
        <h3>Cluster 4 – Radar Altitude Logic</h3>
        <p>A: 1200, B: 1050, C: 1350. One is way off (>200). Others have drift. Find average of good ones.</p>
        <input id="a4"><button onclick="checkAnswer(4)">Submit</button>
        <p id="code4"></p>
    </div>

    <h3>Enter All 4 Authorization Codes</h3>
    <input class="launchInput" id="l1">
    <input class="launchInput" id="l2">
    <input class="launchInput" id="l3">
    <input class="launchInput" id="l4">
    <br>
    <button onclick="launchPhase1()">LAUNCH INTERCEPTOR</button>
</div>

<div id="set2" class="section">
    <h2>Phase 2: Emergency Defense Protocol</h2>
    <div class="cluster">
        <h3>Cluster 5 – Satellite Tracking Uplink</h3>
        <p>Lat: 47.6205° N, Long: 122.3493° W. Convert to DMS. Sum the seconds (rounded).</p>
        <input id="a5"><button onclick="checkAnswer(5)">Submit</button>
        <p id="code5"></p>
    </div>
    <div class="cluster">
        <h3>Cluster 6 – Substitution Cipher Failure</h3>
        <p>“QBKX QL TFQEFK QL ZLROBP...” (Hint: Reverse Alphabet Z=A)</p>
        <input id="a6"><button onclick="checkAnswer(6)">Submit</button>
        <p id="code6"></p>
    </div>
    <div class="cluster">
        <h3>Cluster 7 – Final Interceptor Guidance</h3>
        <p>Int: ⟨7000,1000⟩, Mis: ⟨–6000,500⟩. Relative Velocity Magnitude.</p>
        <input id="a7"><button onclick="checkAnswer(7)">Submit</button>
        <p id="code7"></p>
    </div>

    <h3>Enter All 3 Authorization Codes</h3>
    <input class="launchInput" id="l5">
    <input class="launchInput" id="l6">
    <input class="launchInput" id="l7">
    <br>
    <button onclick="launchPhase2()">FINAL LAUNCH</button>
</div>

<div id="gameContainer">
    <canvas id="gameCanvas"></canvas>
    <div id="gameUI">RADAR TRACKING ACTIVE</div>
</div>

<div id="gameControlsPopup">
    <div class="control-box">
        <h2>INTERCEPTOR CONTROLS</h2>
        <p>USE KEYBOARD TO GUIDE INTERCEPTOR</p>
        <p>
            <span class="key">W</span> <span class="key">A</span> <span class="key">S</span> <span class="key">D</span>
            <br>OR<br>
            <span class="key">↑</span> <span class="key">←</span> <span class="key">↓</span> <span class="key">→</span>
        </p>
        <p style="color:red; margin-top:20px;">INTERCEPT THE HOSTILE TARGET</p>
        <button onclick="startGameEngine()">ENGAGE</button>
    </div>
</div>

<div id="popup"></div>
<button id="skipBtn" onclick="skipTime()">⚠ DO NOT PRESS</button>

<script>
/* --- CORE LOGIC --- */
let time=55*60;
let timer=null;
// Standard answers for the puzzle
let answers={1:"CRYPTO",2:"3500",3:"SEA",4:"1150",5:"71",6:"SPEED",7:"13000"};
let codes={};
let currentPhase = 1; // Tracks if we are in Phase 1 or Phase 2

function beginMission(){
    document.getElementById("start").style.display="none";
    document.getElementById("set1").style.display="block";
    timer=setInterval(updateTimer,1000);
}

function updateTimer(){
    let m=Math.floor(time/60);
    let s=time%60;
    document.getElementById("time").innerText=
    m.toString().padStart(2,'0')+":"+s.toString().padStart(2,'0');
    if(time<=0){
        document.body.innerHTML="<h1 style='color:red;text-align:center;padding-top:200px;'>MISSION FAILURE<br>ITS TOO LATE TO STOP THE ATTACK, USA IS COMPROMISED</h1>";
        clearInterval(timer);
    }
    time--;
}

function randomCode(){
    const chars="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
    let r="";
    for(let i=0;i<4;i++){ r+=chars[Math.floor(Math.random()*chars.length)]; }
    return r;
}

function checkAnswer(n){
    let val=document.getElementById("a"+n).value.trim().toUpperCase();
    if(val===answers[n]){
        if(!codes[n]){
            codes[n]=randomCode();
            document.getElementById("code"+n).innerText="Authorization Code: "+codes[n];
        }
    }else{
        alert("INCORRECT ANSWER");
    }
}

/* --- LAUNCH LOGIC --- */

function launchPhase1(){
    if(
        document.getElementById("l1").value===codes[1] &&
        document.getElementById("l2").value===codes[2] &&
        document.getElementById("l3").value===codes[3] &&
        document.getElementById("l4").value===codes[4]
    ){
        currentPhase = 1;
        initGameSequence();
    }else{
        alert("INVALID AUTHORIZATION SEQUENCE");
    }
}

function launchPhase2(){
    if(
        document.getElementById("l5").value===codes[5] &&
        document.getElementById("l6").value===codes[6] &&
        document.getElementById("l7").value===codes[7]
    ){
        currentPhase = 2;
        initGameSequence();
    }else{
        alert("INVALID AUTHORIZATION SEQUENCE");
    }
}

function initGameSequence(){
    // 1. Flash Launch
    let popup=document.getElementById("popup");
    popup.style.display="flex";
    popup.className="flash";
    popup.innerHTML="LAUNCH INITIATED...<br>ACQUIRING TARGET";
    
    setTimeout(()=>{
        popup.style.display="none";
        popup.className="";
        // 2. Show Controls
        document.getElementById("gameControlsPopup").style.display = "flex";
    }, 2000);
}

/* --- GAME ENGINE --- */
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
let gameLoopId;
let icbm = { x: 0, y: 0, vx: 0, vy: 0 };
let player = { x: 0, y: 0, speed: 5, w: 20, h: 20 };
let explosions = [];
let keys = {};
let gameActive = false;

// Input Handling
window.addEventListener('keydown', (e) => { keys[e.key] = true; });
window.addEventListener('keyup', (e) => { keys[e.key] = false; });

function resizeCanvas(){
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}

function startGameEngine(){
    document.getElementById("gameControlsPopup").style.display = "none";
    document.getElementById("gameContainer").style.display = "block";
    resizeCanvas();
    
    // Reset Player (Center Bottom)
    player.x = canvas.width / 2;
    player.y = canvas.height - 100;
    
    // Reset ICBM (Parabola from mid-left)
    icbm.x = 0;
    icbm.y = canvas.height / 2; 
    
    // SLOWER SPEED as requested
    // Speed scales slightly with width but kept low factor
    let speed = canvas.width / 1200; 
    icbm.vx = speed; 
    icbm.vy = -speed * 0.9; // Initial upward arc
    
    explosions = [];
    gameActive = true;
    loop();
}

function loop(){
    if(!gameActive) return;

    // Clear
    ctx.fillStyle = "rgba(0, 10, 0, 0.4)"; 
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Draw Grid
    ctx.strokeStyle = "#003300";
    ctx.lineWidth = 1;
    ctx.beginPath();
    for(let i=0; i<canvas.width; i+=100){ ctx.moveTo(i,0); ctx.lineTo(i,canvas.height); }
    for(let i=0; i<canvas.height; i+=100){ ctx.moveTo(0,i); ctx.lineTo(canvas.width,i); }
    ctx.stroke();

    // 1. Update Player (WASD / Arrows)
    if(keys['w'] || keys['ArrowUp']) player.y -= player.speed;
    if(keys['s'] || keys['ArrowDown']) player.y += player.speed;
    if(keys['a'] || keys['ArrowLeft']) player.x -= player.speed;
    if(keys['d'] || keys['ArrowRight']) player.x += player.speed;

    // Clamp Player to screen
    if(player.x < 0) player.x = 0;
    if(player.x > canvas.width) player.x = canvas.width;
    if(player.y < 0) player.y = 0;
    if(player.y > canvas.height) player.y = canvas.height;

    // Draw Player (Green Interceptor)
    ctx.fillStyle = "#00ffcc";
    ctx.beginPath();
    ctx.moveTo(player.x, player.y - 10);
    ctx.lineTo(player.x - 10, player.y + 10);
    ctx.lineTo(player.x + 10, player.y + 10);
    ctx.fill();

    // 2. Update ICBM
    icbm.x += icbm.vx;
    icbm.y += icbm.vy;
    icbm.vy += 0.002; // Very low gravity for slow arc
    
    // Draw ICBM (Red)
    ctx.fillStyle = "red";
    ctx.beginPath();
    ctx.moveTo(icbm.x + 15, icbm.y);
    ctx.lineTo(icbm.x - 5, icbm.y - 5);
    ctx.lineTo(icbm.x - 5, icbm.y + 5);
    ctx.fill();
    ctx.font = "14px Courier";
    ctx.fillStyle = "white";
    ctx.fillText("HOSTILE", icbm.x - 20, icbm.y - 15);

    // 3. Collision Detection
    let dist = Math.hypot(icbm.x - player.x, icbm.y - player.y);
    
    // HIT LOGIC
    if(dist < 30){
        handleGameEnd(true); // true = hit
        return;
    }

    // MISS LOGIC (Off screen or hits ground)
    if(icbm.x > canvas.width || icbm.y > canvas.height){
        handleGameEnd(false); // false = miss
        return;
    }

    requestAnimationFrame(loop);
}

function handleGameEnd(isHit){
    gameActive = false;
    
    // Draw explosion if hit
    if(isHit){
        ctx.fillStyle = "orange";
        ctx.beginPath();
        ctx.arc(icbm.x, icbm.y, 50, 0, Math.PI*2);
        ctx.fill();
    }

    setTimeout(()=>{
        document.getElementById("gameContainer").style.display = "none";
        
        if(currentPhase === 1){
            // PHASE 1: ALWAYS MALFUNCTION regardless of Hit or Miss
            let popup = document.getElementById("popup");
            popup.style.display = "flex";
            popup.className = "flash"; 
            
            let msg = isHit ? "INTERCEPTION CONFIRMED... BUT..." : "INTERCEPTION FAILED.";
            msg += "<br><br>GBI MISSED TARGET.<br>TIME IS TICKING...";
            
            popup.innerHTML = "<div style='border:2px solid red; padding:20px; background:black;'>" + msg + "</div>";
            
            setTimeout(()=>{
                popup.style.display="none";
                popup.className="";
                document.getElementById("set1").style.display="none";
                document.getElementById("set2").style.display="block";
            }, 4000);

        } else if (currentPhase === 2){
            // PHASE 2: REAL OUTCOME
            if(isHit){
                // SUCCESS
                document.body.innerHTML="<h1 style='color:lime;text-align:center;padding-top:200px;font-size:50px;'>MISSION SUCCESS<br>THREAT NEUTRALIZED</h1>";
                clearInterval(timer);
            } else {
                // FAILED PHASE 2 - Restart Game or Show Fail
                alert("MISSED TARGET - RE-ENGAGING TRACKING SYSTEMS");
                startGameEngine(); // Retry the game immediately
            }
        }
    }, 500);
}

function skipTime(){
    time-=600;
    if(time<0) time=0;
}
</script>

</body>
</html>